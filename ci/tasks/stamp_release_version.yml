platform: linux

image_resource:
  type: docker-image
  source:
    repository: concourse/buildroot
    tag: git

inputs:
- name: pcf-pipelines
- name: version

outputs:
- name: pcf-pipelines-release

run:
  path: bash
  args:
  - -ce
  - |
    export HOME=$PWD

    git config --global user.name "CI Bot"
    git config --global user.email "c0-coreteam+pcf-pipelines-ci@pivotal.io"

    git clone pcf-pipelines pcf-pipelines-release

    version=v$(cat version/version)

    files=$(grep -r -l pcf-pipelines-tarball pcf-pipelines-release)
    for f in "${files[@]}"; do
      sed -i "/product_slug: pcf-automation/ {N; s/\(product_slug: pcf-automation.*product_version: v4.0.0-rc.14

    cd pcf-pipelines-release

    git add -A
    git commit -m "Bump pcf-pipelines-tarball version to ${version}"
